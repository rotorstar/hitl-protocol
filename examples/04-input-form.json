{
  "_comment": "HITL Protocol v0.5 — Example: Structured Input Form (Single-Step)",
  "_spec": "https://github.com/rotorstar/hitl-protocol",
  "_note": "Migrated from context.required_fields to context.form.fields (v0.5 form field definitions)",
  "scenario": "A job application service needs information that the agent cannot infer from the applicant's profile: salary expectations, earliest start date, visa/work authorization status, and relocation willingness. The service presents a structured form. The human fills it out and submits.",
  "steps": [
    {
      "step": 1,
      "description": "Agent triggers the application process. The service detects missing required fields that only the human can provide.",
      "request": {
        "method": "POST",
        "url": "https://api.applybot.example/v1/applications",
        "headers": {
          "Content-Type": "application/json",
          "Authorization": "Bearer sk_agent_apply_q1w2e3r4s5t6",
          "X-Agent-Id": "openclaw-agent-4c1d"
        },
        "body": {
          "job_id": "job_4d5e6f7g",
          "applicant": {
            "name": "Alex Mueller",
            "email": "alex.mueller@example.com",
            "resume_url": "https://storage.example.com/resumes/alex-mueller-2026.pdf",
            "linkedin": "https://linkedin.com/in/alexmueller"
          },
          "cover_letter_case_id": "review_content_r2_a1b2c3"
        }
      }
    },
    {
      "step": 2,
      "description": "Service returns HTTP 202 with an input-type hitl object. The context.form defines structured form fields for the review page to render.",
      "response": {
        "status": 202,
        "headers": {
          "Content-Type": "application/json",
          "Retry-After": "30"
        },
        "body": {
          "status": "human_input_required",
          "message": "Application for Staff Frontend Developer at Klarna requires additional information from the applicant.",
          "data": {
            "application_id": "app_k7m8n9p0",
            "job_title": "Staff Frontend Developer",
            "company": "Klarna",
            "location": "Berlin, Germany"
          },
          "hitl": {
            "spec_version": "0.5",
            "case_id": "review_input_q1w2e3r4",
            "review_url": "https://applybot.example/review/input_q1w2e3r4?token=R5sT7uV9wX1yZ3aB5cD7eF9gH1iJ3kL5mN7oP9q",
            "poll_url": "https://api.applybot.example/v1/reviews/input_q1w2e3r4/status",
            "callback_url": null,
            "type": "input",
            "prompt": "Please provide salary expectations, start date, and work authorization details for your Klarna application",
            "timeout": "72h",
            "default_action": "skip",
            "created_at": "2026-02-22T10:30:00Z",
            "expires_at": "2026-02-25T10:30:00Z",
            "reminder_at": [
              "2026-02-23T10:30:00Z",
              "2026-02-24T18:00:00Z"
            ],
            "context": {
              "job_title": "Staff Frontend Developer",
              "company": "Klarna",
              "location": "Berlin, Germany",
              "form": {
                "fields": [
                  {
                    "key": "salary_expectation",
                    "label": "Salary Expectation (EUR, annual gross)",
                    "type": "number",
                    "required": true,
                    "placeholder": "e.g. 105000",
                    "hint": "The listed range is 95,000 - 120,000 EUR",
                    "sensitive": true,
                    "validation": {
                      "min": 0,
                      "max": 500000
                    }
                  },
                  {
                    "key": "salary_negotiable",
                    "label": "Salary Negotiable?",
                    "type": "boolean",
                    "required": true,
                    "default": true
                  },
                  {
                    "key": "earliest_start_date",
                    "label": "Earliest Start Date",
                    "type": "date",
                    "required": true,
                    "hint": "Consider your current notice period"
                  },
                  {
                    "key": "work_authorization",
                    "label": "Work Authorization in Germany",
                    "type": "select",
                    "required": true,
                    "options": [
                      { "value": "citizen", "label": "EU/EEA Citizen" },
                      { "value": "permanent_resident", "label": "Permanent Residence Permit" },
                      { "value": "work_visa", "label": "Current Work Visa" },
                      { "value": "needs_sponsorship", "label": "Requires Visa Sponsorship" },
                      { "value": "blue_card", "label": "EU Blue Card Holder" }
                    ]
                  },
                  {
                    "key": "willing_to_relocate",
                    "label": "Willing to Relocate to Berlin?",
                    "type": "select",
                    "required": true,
                    "options": [
                      { "value": "already_local", "label": "Already in Berlin" },
                      { "value": "yes_immediately", "label": "Yes, immediately" },
                      { "value": "yes_with_time", "label": "Yes, need 1-3 months" },
                      { "value": "remote_only", "label": "Prefer fully remote" }
                    ]
                  },
                  {
                    "key": "additional_notes",
                    "label": "Additional Notes (optional)",
                    "type": "textarea",
                    "required": false,
                    "placeholder": "Any other information relevant to your application",
                    "validation": {
                      "maxLength": 1000
                    }
                  }
                ]
              }
            },
            "surface": {
              "format": "json-render",
              "version": "1.0"
            }
          }
        }
      }
    },
    {
      "step": 3,
      "description": "Agent forwards the form URL to the human",
      "agent_action": {
        "channel": "telegram",
        "message": "Your application for Staff Frontend Developer at Klarna needs a few more details: salary expectations, start date, and work authorization.\n\nPlease fill out the form: https://applybot.example/review/input_q1w2e3r4?token=R5sT7uV9wX1yZ3aB5cD7eF9gH1iJ3kL5mN7oP9q\n\nThe salary range listed is 95,000 - 120,000 EUR."
      }
    },
    {
      "step": 4,
      "description": "Agent polls and receives 'completed' — human submitted all required fields",
      "request": {
        "method": "GET",
        "url": "https://api.applybot.example/v1/reviews/input_q1w2e3r4/status",
        "headers": {
          "Authorization": "Bearer sk_agent_apply_q1w2e3r4s5t6"
        }
      },
      "response": {
        "status": 200,
        "headers": {
          "Content-Type": "application/json"
        },
        "body": {
          "status": "completed",
          "case_id": "review_input_q1w2e3r4",
          "created_at": "2026-02-22T10:30:00Z",
          "opened_at": "2026-02-22T11:15:03Z",
          "expires_at": "2026-02-25T10:30:00Z",
          "completed_at": "2026-02-22T11:19:46Z",
          "result": {
            "action": "submit",
            "data": {
              "salary_expectation": 108000,
              "salary_negotiable": true,
              "earliest_start_date": "2026-05-01",
              "work_authorization": "blue_card",
              "willing_to_relocate": "already_local",
              "additional_notes": "Currently on EU Blue Card, valid through 2028. Open to a slightly lower base if equity/RSU compensation is included."
            }
          },
          "responded_by": {
            "name": "Alex Mueller",
            "email": "alex.mueller@example.com"
          }
        }
      }
    }
  ]
}
