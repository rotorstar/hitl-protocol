{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://hitl-protocol.org/schemas/v0.6/hitl-object.json",
  "title": "HITL Object",
  "description": "The hitl object within an HTTP 202 response, as defined by HITL Protocol v0.6",
  "type": "object",
  "required": [
    "spec_version",
    "case_id",
    "review_url",
    "poll_url",
    "type",
    "prompt",
    "created_at",
    "expires_at"
  ],
  "properties": {
    "spec_version": {
      "type": "string",
      "const": "0.6",
      "description": "Protocol version. MUST be '0.6' for this spec."
    },
    "case_id": {
      "type": "string",
      "pattern": "^[a-zA-Z0-9_-]+$",
      "description": "Unique, URL-safe identifier for this review case. RECOMMENDED format: review_{random}"
    },
    "review_url": {
      "type": "string",
      "format": "uri",
      "description": "Fully qualified HTTPS URL to the review page. MUST include an opaque bearer token for authentication."
    },
    "poll_url": {
      "type": "string",
      "format": "uri",
      "description": "Fully qualified URL to the status polling endpoint."
    },
    "callback_url": {
      "oneOf": [
        { "type": "string", "format": "uri" },
        { "type": "null" }
      ],
      "description": "If the agent provided a callback URL in the original request, it is echoed here. Otherwise null."
    },
    "events_url": {
      "type": "string",
      "format": "uri",
      "description": "Optional SSE endpoint for real-time status events."
    },
    "type": {
      "type": "string",
      "anyOf": [
        {
          "enum": [
            "approval",
            "selection",
            "input",
            "confirmation",
            "escalation"
          ]
        },
        {
          "pattern": "^x-"
        }
      ],
      "description": "Review type category. One of the five standard types, or a custom type prefixed with 'x-'."
    },
    "prompt": {
      "type": "string",
      "maxLength": 500,
      "description": "Short description of what the human needs to decide."
    },
    "timeout": {
      "type": "string",
      "description": "Duration the review stays open. ISO 8601 duration (PT24H, P7D) or shorthand (24h, 7d). Default: 24h."
    },
    "default_action": {
      "type": "string",
      "enum": [
        "skip",
        "approve",
        "reject",
        "abort"
      ],
      "description": "Action taken if the review expires without a response."
    },
    "created_at": {
      "type": "string",
      "format": "date-time",
      "description": "Timestamp when the review case was created."
    },
    "expires_at": {
      "type": "string",
      "format": "date-time",
      "description": "Timestamp when the review case expires."
    },
    "context": {
      "type": "object",
      "additionalProperties": true,
      "properties": {
        "form": {
          "type": "object",
          "description": "Structured form definition for Input-type reviews. Use either 'fields' (single-step) or 'steps' (multi-step), not both.",
          "properties": {
            "fields": {
              "type": "array",
              "items": { "$ref": "form-field.json" },
              "description": "Array of form field definitions for single-step forms."
            },
            "steps": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["title", "fields"],
                "properties": {
                  "title": {
                    "type": "string",
                    "description": "Step heading displayed in the wizard UI."
                  },
                  "description": {
                    "type": "string",
                    "description": "Subtitle or helper text for the step."
                  },
                  "fields": {
                    "type": "array",
                    "items": { "$ref": "form-field.json" },
                    "description": "Array of form field definitions for this step."
                  }
                },
                "additionalProperties": false
              },
              "description": "Array of wizard steps for multi-step forms."
            },
            "session_id": {
              "type": "string",
              "description": "Optional session identifier for form state persistence. Enables resume after browser close."
            }
          },
          "oneOf": [
            { "required": ["fields"] },
            { "required": ["steps"] }
          ],
          "additionalProperties": false
        }
      },
      "description": "Arbitrary key-value pairs providing additional context about the review. Not processed by the agent â€” for human consumption on the review page. For Input-type reviews, MAY include a 'form' object with structured field definitions."
    },
    "reminder_at": {
      "oneOf": [
        {
          "type": "string",
          "format": "date-time"
        },
        {
          "type": "array",
          "items": {
            "type": "string",
            "format": "date-time"
          }
        }
      ],
      "description": "When reminder(s) should be sent. Single timestamp or array of timestamps."
    },
    "previous_case_id": {
      "type": "string",
      "pattern": "^[a-zA-Z0-9_-]+$",
      "description": "Links to a prior case in a multi-round review chain."
    },
    "surface": {
      "type": "object",
      "properties": {
        "format": {
          "type": "string",
          "description": "UI format identifier (e.g., json-render, a2ui, adaptive-cards)"
        },
        "version": {
          "type": "string",
          "description": "Version of the UI format"
        }
      },
      "description": "Optional declaration of the review page UI format."
    },
    "submit_url": {
      "type": "string",
      "format": "uri",
      "description": "API endpoint where the agent MAY submit simple responses on behalf of the human via native messaging buttons. MUST be HTTPS. See Section 7.5."
    },
    "submit_token": {
      "type": "string",
      "minLength": 32,
      "description": "Opaque bearer token for authenticating agent submissions via submit_url. Service stores only SHA-256 hash. MUST be different from the review URL token."
    },
    "inline_actions": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Actions permitted via submit_url without visiting review_url. When omitted and submit_url is present, ALL actions for the review type are permitted. When present, only listed actions are accepted via submit_url."
    }
  },
  "dependentRequired": {
    "submit_url": ["submit_token"],
    "submit_token": ["submit_url"]
  },
  "additionalProperties": false
}
